% MSL_in.m 
%   Create input structure for MSL guided entry at Mars
%
% Aeroassist Simulation source code
%
% Developed by:
%   Space Systems Design Lab
%   Daniel Guggenheim School of Aerospace Engineering
%   Georgia Institute of Technology
%
% Inputs:
%   none
%   
% Outputs:
%   in - struct, multi, input structure with default values
%
% Major Revision History:
%   *Created OCT 2011, Z. Putnam
%   *1 AUG 2012, Z.R.Putnam, updated

function in = MSL_in()
%#codegen

%% Define input structure
in = default_in;


%% Planetary data

in.p = get_planetary_data( 3, 3 ); % Load settings for Mars, table atmopshere model, winds


%% Simulation data

% Termination conditions
in.s.term.or.type(1) = int8(0); % int8, nd, crossing/equality condition
in.s.term.or.var(1) = uint8(4); % uint8, nd, termination mode (Planet-relative velocity magnitude)
in.s.term.or.value(1) = 540; % double, m/s, terminate at 540 m/s planet-relative velocity magnitude
in.s.term.or.direction(1) = int8(-1); % int8, nd, negative crossing

% Trajectory
fpa0 = -15.5*pi/180;  % Inertial FPA; rad
in.s.traj.rate = 10; % double, Hz, integration rate
in.s.traj.t_ini = 0; % double, s, initial time
in.s.traj.t_max = 2500; % double, s, maximum allowable time
in.s.traj.r_pci_ini = [(in.p.r_e + 135e3); 0; 0]; % double(3), m, initial PCI position vector, 125 km altitude
in.s.traj.v_pci_ini = 6100 .* [sin(fpa0); cos(fpa0); 0];  % Inertial velocity


%% Vehicle data

in.v.mp.m_ini = 3300; % double, kg, vehicle mass

% Aerodynamics
in.v.aero.mode = uint8(2); % uint8, nd, Mach-dependent table look-up aerodynamic coefficients
in.v.aero.aoa = -15.75*pi/180;
in.v.aero.area_ref = pi*(4.5/2)^2; % double, m^2, aerodynamic reference area
in.v.aero.nose_radius = 1; % double, m, nose radius
temp = load(['data' filesep 'aero_MSL.mat']);
in.v.aero.table = temp.table; %get_clcd_table(in.v.aero.aoa)
in.s.traj.bank_ini = 75*pi/180; % deg -> rad

% GNC
in.v.gnc.g.p.bank_mode = uint8(4); % uint8, nd, MSL guidance

% Guidance parameters
in.v.gnc.g.p_msl.ref_trajectory = [ ...
    0,-124.061785691454,4.80042430927783,0.259858060777131,-6600.73341960905,30.7240206984305,1852; ... 
    365.310660627106,-124.061785691454,4.80042430927783,0.259858060777131,-6600.73341960905,30.7240206984305,1852; ... 
    517.599561691239,-72.8719427386921,7.00942408447770,76.5727789174487,-4602.64809588625,13855.5278929808,15907.7188319717; ... 
    669.888462755371,-44.3044529743457,10.6726001552196,104.588997961193,-3052.04197046387,25017.3407823457,45374.9253858080; ... 
    822.177363819503,-31.8713124049649,15.3456491862056,117.954505835382,-2197.01574191877,34243.9663937347,80003.5428755182; ... 
    974.466264883635,-30.2248786074264,20.9520193914981,125.632360784512,-1810.96243356052,42123.4059729864,117469.336753523; ... 
    1126.75516594777,-36.3511629109583,27.3928895309239,130.444432872361,-1475.90741669280,49010.3305805340,156718.492747986; ... 
    1279.04406701190,-48.3720998986756,34.5329057893574,133.615742035995,-1235.73942871725,55152.0577364735,197139.917146256; ... 
    1431.33296807603,-65.0878578796835,42.2733489564215,135.761059482802,-1104.29747924940,60721.5496916940,238359.247184499; ... 
    1583.62186914016,-85.7020513037066,50.4808825229905,137.215817398675,-959.329256284531,65842.0317336436,280123.661111277; ... 
    1735.91077020430,-109.568548594008,59.0432122825591,138.219203885215,-871.796192009810,70615.1256102043,322256.243863807; ... 
    1888.19967126843,-136.252584413606,67.8254629585716,138.906916322989,-801.237676666289,75111.0081224964,364642.222290638; ... 
    2040.48857233256,-165.452698270661,76.8562924436063,139.366891778413,-715.524049548712,79380.5829669923,407200.270333402; ... 
    2192.77747339669,-196.946305213314,85.9726865477857,139.659713155967,-665.556748335910,83463.0461360200,449870.315801684; ... 
    2345.06637446083,-230.575731867815,95.0102333043766,139.837641024393,-617.569278110895,87391.8630668458,492612.312647796; ... 
    2497.35527552496,-266.057351793356,103.882277811455,139.950254158064,-571.946935371498,91206.5887678740,535393.313256470; ... 
    2649.64417658909,-303.289385667079,112.517496613223,140.025871139059,-535.004892897434,94930.1524896196,289101.255232123; ... 
    2801.93307765322,-342.141799346786,120.893103649177,140.085409555411,-509.638911808615,98584.1557433399,310514.603006604; ... 
    2954.22197871735,-382.653772988040,128.787153510445,140.146610280650,-473.912442253425,102183.214728780,331935.255333358; ... 
    3106.51087978149,-424.578812535886,136.061388972523,140.230752598902,-437.588745916511,105753.163536310,353364.035289807; ... 
    3258.79978084562,-467.874201761336,142.641419921086,140.358230150967,-417.552945671853,109312.930117912,374809.784918983; ... 
    3411.08868190975,-512.495349358635,148.464146389912,140.543753349617,-404.312045458424,112880.548197980,396281.221500667; ... 
    3563.37758297388,-558.399008972032,153.441744011974,140.799016061271,-392.360000299239,116473.701173303,417785.791393305; ... 
    3715.66648403802,-605.544119472453,157.486911951835,141.136336038838,-381.067343461078,120111.211279270,439335.272168839; ... 
    3867.95538510215,-653.897084033230,160.527254337223,141.568332367303,-385.484205327315,123812.974098497,460943.781245872; ... 
    4020.24428616628,-703.432301505106,162.492681289722,142.109670039473,-378.765723215549,127601.203224713,482632.962018594; ... 
    4172.53318723041,-754.135327164960,163.248507020162,142.774314900636,-366.724370461898,131499.027628065,504414.782258574; ... 
    4324.82208829455,-806.003166450382,162.166218300403,143.589911686623,-347.852321939407,135541.043376728,526307.124190074; ... 
    4477.11098935868,-859.051110344481,159.190835156014,144.600098471070,-350.630821683005,139777.152583200,548347.325310510; ... 
    4629.39989042281,-913.311529470123,154.528461405535,145.848252198511,-363.889148624629,144262.037203993,570568.171220313; ... 
    4781.68879148694,-968.833343645491,148.249729343785,147.380375399493,-366.986862802926,149058.216280250,593008.309904624; ... 
    4933.97769255107,-1025.68593486071,140.283423251231,149.252248026524,-379.051615920722,154243.635996510,615713.250219708; ... 
    5086.26659361521,-1083.96999867722,129.588543291569,151.547334756980,-362.777974509178,159928.214181162,638702.044503976; ... 
    5238.55549467934,-1144.21861072467,114.417578696040,154.618334895996,-396.811098809237,166514.911796303,662209.474528951; ... 
    5390.84439574347,-1206.55472858475,96.8770887705977,158.680691934510,-445.425679583092,174264.591824347,686256.280077600; ... 
    5543.13329680760,-1271.92747706991,77.4990666829785,164.417464144711,-585.207776348882,184005.832719225,711122.455870311; ... 
    5695.42219787174,-1341.76692591694,56.5911900345845,172.820489025351,-812.992803389663,196951.399398047,737105.551950209; ... 
    5847.71109893587,-1421.35716509683,32.6475141094470,187.640614574147,-1357.79949439240,217579.647050100,765073.194313082; ... 
    6000,-1603.43025646954,1.00925630838719,280.352593223041,-44784.6128866180,329084.463979349,800935.029059809; ... 
    10668,-1603.43025646954,1.00925630838719,280.352593223041,-44784.6128866180,329084.463979349,800935.029059809];

in.v.gnc.g.p_msl.overcontrol = 4.0; % nd
in.v.gnc.g.p_msl.ref_lodv = 1.485967e-001; % lodv_frac_cmd.*veh.aero.nom_lod; nd
in.v.gnc.g.p_msl.V_sat = sqrt(in.p.mu/in.p.r_m); % m/s
in.v.gnc.g.p_msl.E_flatness = 1 - sqrt(1 - (in.p.r_e^2-in.p.r_p^2)/in.p.r_e^2);
in.v.gnc.g.p_msl.E_g_surface = in.p.surface_g; % m/s^2
in.v.gnc.g.p_msl.E_rotation_rate = norm(in.p.omega); % rad/s
in.v.gnc.g.p_msl.tof_prm = 600; % sec
in.v.gnc.g.p_msl.E_radius_eq = in.p.r_e; % m
in.v.gnc.g.p_msl.V_rel_switch = in.v.gnc.g.p_msl.V_sat/2; % m/s
in.v.gnc.g.p_msl.E_radius_avg = in.p.r_m; % m
in.v.gnc.g.p_msl.V_ha = 1100; % m/s - Set to 1100 m/s for MSL
in.v.gnc.g.p_msl.lat_db_gain = 30; %
in.v.gnc.g.p_msl.lat_db_min = 1000; % m
in.v.gnc.g.p_msl.D_sensible_atm = 0.5*9.81; % Initial Drag acceleration, m/s^2
in.v.gnc.g.p_msl.lod_nom = 0.2476611; % nd
in.v.gnc.g.p_msl.lodv_lim = cosd(15)*in.v.gnc.g.p_msl.lod_nom; % nd
in.v.gnc.g.p_msl.pre_bank = 75*pi/180; % rad

in.v.gnc.g.p_msl.tgt_geod_alt = 0.0; % m
in.v.gnc.g.p_msl.tgt_geod_lat = 0.0; % rad
in.v.gnc.g.p_msl.tgt_lon = 10*pi/180; % rad

in.v.gnc.c.p.bank_mode = uint8(2); % rate limited
in.v.gnc.c.p.bank_rate_lim = double(0.3491); % 20deg/s

end % MSL_in()
